<html ng-app="StageApp">
<head>
    <title>Production Stage</title>
    <script src='./scripts/angularjs.js'></script>
    <script src='./scripts/Stage.js'></script>
    <script src='./scripts/Filters.js'></script>
    <script src='./scripts/UtilityFunctions.js'></script>
    <link rel='stylesheet' href="./styles/Parts.css" />
</head>
<body ng-controller='StageCtrlr' style='font-size: x-small'>
    <table align='center' width='100%' border=0>
    <tr ng-show='locID > 0'>
        <td align='left'>
            <input type='button' value='Reset Filters' ng-click='ResetFilters();' />
        </td>
        <td align='right'>
            <input type='button' value='Unassigned Cars' ng-click='UnassignedCarsFilter();' ng-class='UC_Class'/>
        </td>
        <td align='right'>
            <input type='button' value='Switch Colors' ng-click='ChooseBGMode(BackgroundMode);'>
            &nbsp;by:&nbsp;{{ BackgroundMode }}
        </td>
        <td align='right'>
            Last Update: {{ lastUpdate }}
        </td>
    </tr>
    <tr>
        <td align='left' ng-show='locID > 0'>
            Technician:
            <select ng-model='tech'>
                <option value=''>All Techs</option>
                <option ng-repeat='eachTech in techList | filter: { locationID: locID }' value='{{ eachTech.name }}'>
                    {{ eachTech.name }}
                </option>
            </select>
        </td>
        <td align='left' ng-show='locID > 0'>
            Estimator:
            <select ng-model='estim'>
                <option value=''>All Estimators</option>
                <option ng-repeat='estimator in estimatorList | filter: { locationID: locID }' value='{{ estimator.name }}'>
                    {{ estimator.name }}
                </option>
            </select>
        </td>
        <td align='left' ng-show='locID > 0'>
            Search: <input type='text' ng-model='searchText'/>&nbsp;
            <input type='button' value='Clear' ng-click='searchText = ""'>
        </td>
        <td align='right'>
            <div ng-hide='locID > 0' style='color : red;'>
                <blink><b>Select a shop</b></blink>
            </div>
            Shop:
            <select ng-model='locID' ng-change='SwitchShops(locID);'>
                <option value=1 selected>CarStar City Auto</option>
                <option value=2>CarStar Simi Valley</option>
            </select>
        </td>
    </tr>
    </table>

    <table id=id="tblPriority" border=1>
    <tr>
        <th align='center' ng-show='tech > ""'>
            <img ng-src='./images/{{ tech.toUpperCase() }}.jpg' style="max-width: 100px; max-height: 100px"  alt="{{ eachCar.Technician }}">
            <br/>{{ tech }}
        </th>
        <td ng-repeat='eachCar in priorityCars | filter : { locationID : locID, technician : tech }'
            ng-class='eachCar.borderColor'
            ng-click='ChangeBorder(eachCar);'
            width='150'>
            <div ng-include='"Priority_Car.html"' ng-class='Set_BG_Class(BackgroundMode, eachCar);'></div>
        </td>
    </tr>
    </table>

    <table border=1>
    <tr class='heading'>
        <th ng-repeat='stage in stages' width='{{ colWidth }}%' ng-click='MoveCar(stage.order_no);'>
            {{ stage.description  }}
        </th>
    </tr>
    <tr class="bgLiteGrey">
        <td valign='top' ng-repeat='stage in stages'>
            <table border="1" id='CheckInPreScan' width='100%'>
            <tr ng-init='lastCarIndex = production_stage[stage.order_no].cars.length - 1'
                ng-repeat='eachCar in production_stage[stage.order_no].cars
                            | filter: { locationID: locID }
                            | filter: { technician: tech}
                            | filter: { estimator: estim }
                            | filter : searchText
                            | FilterUnassignedCars : filterOn' >
                <td ng-class='eachCar.borderColor' ng-click='ChangeBorder(eachCar);'>
                    <div ng-include='"Stage_Car.html"' ng-class='Set_BG_Class(BackgroundMode, eachCar);'>
                </td>
            </tr>
            </table>
        </td>
    </tr>
    </table>
    <br/>
</body>
</html>
